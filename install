#!/bin/bash
# نصب پیش‌نیازها
sudo apt update && sudo apt install -y expect curl

# دریافت دامنه از کاربر
read -p "Enter your domain (e.g. uk2.dadklnad.com): " DOMAIN

# استخراج بخش اول دامنه (قبل از اولین نقطه)
SUBDOMAIN=$(echo "$DOMAIN" | cut -d'.' -f1)

# نصب 3x-ui با پاسخ خودکار
expect <(cat <<'EOF'
#!/usr/bin/expect -f
set timeout -1
spawn /bin/bash -c {bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)}
expect {
    -re {Would you like to customize the Panel Port settings.*\[y/n\]:} {
        send "n\r"
        exp_continue
    }
    eof
}
interact
EOF
)

# تاخیر ۳ ثانیه‌ای قبل از اجرای تنظیمات x-ui
echo "Waiting 3 seconds before starting x-ui setup..."
sleep 3

# اجرای x-ui و انجام مراحل گواهی SSL با پاسخ خودکار
expect <<EOF
set timeout -1
spawn x-ui
expect "Please enter your selection [0-25]"
send "18\r"
expect "Please enter a number:"
send "1\r"
expect "Please enter your domain name:"
send "$DOMAIN\r"
expect "Please choose which port to use (default is 80):"
send "80\r"
expect "Would you like to modify --reloadcmd for ACME? (y/n):"
send "n\r"
expect "Would you like to set this certificate for the panel? (y/n):"
send "n\r"

# شبیه‌سازی Ctrl+Z برای برگشت به ترمینال
send "\032"

EOF

echo "done"
