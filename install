#!/bin/bash
# نصب پیش‌نیازها
sudo apt update && sudo apt install -y expect curl

# نصب 3x-ui با پاسخ خودکار
expect <(cat <<'EOF'
#!/usr/bin/expect -f
set timeout -1
spawn /bin/bash -c {bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)}
expect {
    -re {Would you like to customize the Panel Port settings.*\[y/n\]:} {
        send "n\r"
        exp_continue
    }
    eof
}
interact
EOF
)

# بعد از نصب، پاک کردن محتوای x-ui.db و نوشتن "hello"
sudo sh -c 'echo "
SQLite format 3   @   ÃÚ              	                                               ÃÚ .Š
0 
  Š8
"ÿÙßb
7,	ø ›                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
 =+indexidx_enable_traffic_resetinboundsCREATE INDEX `idx_enable_traffic_reset` ON `inbounds`(`enable`,`traffic_reset`) 11Gtablehistory_of_seedershistory_of_seeders
CREATE TABLE `history_of_seeders` (`id` integer PRIMARY KEY AUTOINCREMENT,`seeder_name` text)ƒI
 ++†Itableclient_trafficsclient_trafficsCREATE TABLE `client_traffics` (`id` integer PRIMARY KEY AUTOINCREMENT,`inbound_id` integer,`enable` numeric,`email` text,`up` integer,`down` integer,`all_time` integer,`expiry_time` integer,`total` integer,`reset` integer DEFAULT 0,`last_online` integer DEFAULT 0,CONSTRAINT `fk_inbounds_client_stats` FOREIGN KEY (`inbound_id`) REFERENCES `inbounds`(`id`),CONSTRAINT `uni_client_traffics_email` UNIQUE (`email`))=Q+ indexsqlite_autoindex_client_traffics_1client_trafficsc 11‚qtableinbound_client_ipsinbound_client_ips	CREATE TABLE `inbound_client_ips` (`id` integer PRIMARY KEY AUTOINCREMENT,`client_email` text,`ips` text,CONSTRAINT `uni_inbound_client_ips_client_email` UNIQUE (`client_email`))C	W1 indexsqlite_autoindex_inbound_client_ips_1inbound_client_ips
u  =tablesettingssettingsCREATE TABLE `settings` (`id` integer PRIMARY KEY AUTOINCREMENT,`key` text,`value` text)‚ //ƒ5tableoutbound_trafficsoutbound_trafficsCREATE TABLE `outbound_traffics` (`id` integer PRIMARY KEY AUTOINCREMENT,`tag` text,`up` integer DEFAULT 0,`down` integer DEFAULT 0,`total` integer DEFAULT 0,CONSTRAINT `uni_outbound_traffics_tag` UNIQUE (`tag`))AU/ indexsqlite_autoindex_outbound_traffics_1outbound_traffics ƒZ ‡ tableinboundsinboundsCREATE TABLE `inbounds` (`id` integer PRIMARY KEY AUTOINCREMENT,`user_id` integer,`up` integer,`down` integer,`total` integer,`all_time` integer DEFAULT 0,`remark` text,`enable` numeric,`expiry_time` integer,`traffic_reset` text DEFAULT "never",`last_traffic_reset_time` integer DEFAULT 0,`listen` text,`port` integer,`protocol` text,`settings` text,`stream_settings` text,`tag` text,`sniffing` text,CONSTRAINT `uni_inbounds_tag` UNIQUE (`tag`))/C indexsqlite_autoindex_inbounds_1inbounds       P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)t GtableusersusersCREATE TABLE `users` (`id` integer PRIMARY KEY AUTOINCREMENT,`username` text,`password` text)
   µ µ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           I sysadmin$2a$10$gYIjfVWAXJ17RY5KjhURcuwiTFQUbp1RjlozItw20q4m2NZMT64EG
° ¢ ößÑ¢¼                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                inbounds   	client_+client_trafficssettings/1	history_of_seeders	users
   ­ w­                                                                                                                                                                                                                                                                                                                                                                                                                                 G 		
‡3E'‚+ Ç$ŠÒ £ïë ¬·§ïRealitynever  'vless{
  "clients": [
    {
      "id": "6384deb7-955e-4d67-bc04-d73b86e0ac38",
      "security": "",
      "password": "",
      "flow": "",
      "email": "VPN-US1",
      "limitIp": 0,
      "totalGB": 0,
      "expiryTime": 0,
      "enable": true,
      "tgId": 0,
      "subId": "56rnrl3er8suyl2i",
      "comment": "",
      "reset": 0,
      "created_at": 1760288580000,
      "updated_at": 1760288580000
    }
  ],
  "decryption": "none",
  "encryption": "none"
}{
  "network": "xhttp",
  "security": "reality",
  "externalProxy": [],
  "realitySettings": {
    "show": false,
    "xver": 0,
    "target": "google.com:443",
    "serverNames": [
      "google.com",
      "www.google.com"
    ],
    "privateKey": "8BiPFRZQsqJOVudkQZOiimQ_GCLrWL9QD9X5fZDL-GQ",
    "minClientVer": "",
    "maxClientVer": "",
    "maxTimediff": 0,
    "shortIds": [
      "dbb247acf8e5",
      "82c433b14c8a98",
      "47a614cb",
      "fc8faf",
      "c5ced62553",
      "7ce2",
      "2948d091dfa5a97e",
      "8d"
    ],
    "mldsa65Seed": "",
    "settings": {
      "publicKey": "38UnY9kIQQii1RPUF9YNGyRkF7EDteIXMNq5SMI5MBo",
      "fingerprint": "chrome",
      "serverName": "",
      "spiderX": "/nihato",
      "mldsa65Verify": ""
    }
  },
  "xhttpSettings": {
    "path": "/miatohakatashi?ed=2096",
    "host": "",
    "headers": {},
    "scMaxBufferedPosts": 30,
    "scMaxEachPostBytes": "1000000",
    "scStreamUpServerSecs": "20-80",
    "noSSEHeader": false,
    "xPaddingBytes": "100-1000",
    "mode": "auto"
  }
}inbound-40999{
  "enabled": false,
  "destOverride": [
    "http",
    "tls",
    "quic",
    "fakedns"
  ],
  "metadataOnly": false,
  "routeOnly": false
} 		
†U”-%‚+ /Õ›Y”­ysÇÝO^[VPNnever'vless{
  "clients": [
    {
      "comment": "",
      "created_at": 1758405068000,
      "email": "US-1",
      "enable": true,
      "expiryTime": 0,
      "flow": "",
      "id": "279542bd-49cf-45dd-9077-e66b6c7e8262",
      "limitIp": 0,
      "reset": 0,
      "subId": "9n8423e2m1wpkf7b",
      "tgId": 0,
      "totalGB": 0,
      "updated_at": 1758699200000
    }
  ],
  "decryption": "none",
  "encryption": "none"
}{
  "network": "xhttp",
  "security": "tls",
  "externalProxy": [
    {
      "forceTls": "same",
      "dest": "172.67.191.180",
      "port": 2087,
      "remark": ""
    }
  ],
  "tlsSettings": {
    "serverName": "us-1.mrkheyrabadi.top",
    "minVersion": "1.0",
    "maxVersion": "1.3",
    "cipherSuites": "",
    "rejectUnknownSni": false,
    "verifyPeerCertInNames": [
      "dns.google",
      "cloudflare-dns.com"
    ],
    "disableSystemRoot": false,
    "enableSessionResumption": false,
    "certificates": [
      {
        "certificateFile": "/root/cert/us-1.mrkheyrabadi.top/fullchain.pem",
        "keyFile": "/root/cert/us-1.mrkheyrabadi.top/privkey.pem",
        "oneTimeLoading": false,
        "usage": "encipherment",
        "buildChain": false
      }
    ],
    "alpn": [
      "h2",
      "http/1.1"
    ],
    "echServerKeys": "",
    "echForceQuery": "none",
    "settings": {
      "allowInsecure": true,
      "fingerprint": "chrome",
      "echConfigList": ""
    }
  },
  "xhttpSettings": {
    "path": "/utd?ed=2087",
    "host": "us-1.mrkheyrabadi.top",
    "headers": {},
    "scMaxBufferedPosts": 30,
    "scMaxEachPostBytes": "1000000",
    "scStreamUpServerSecs": "20-80",
    "noSSEHeader": false,
    "xPaddingBytes": "100-1000",
    "mode": "auto"
  }
}inbound-2087{
  "enabled": false,
  "destOverride": [
    "http",
    "tls",
    "quic",
    "fakedns"
  ],
  "metadataOnly": false,
  "routeOnly": false
}
   Þ ðÞ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  'inbound-40999%	inbound-2087
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
   /R ïÎ¢ˆteVE5þì×Á±¡|gQ7*
ï
×
É
º
©
—
ˆ
w
g
U
/
ýèÜÅµ }kR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            / !datepickergregorian. %
subJsonRules- !
subJsonMux, '
subJsonNoises+ +
subJsonFragment* !
subJsonURI) #subJsonPath/json/
( 
subURI' #subShowInfotrue& !subEncrypttrue% =
externalTrafficInformURI$$ CexternalTrafficInformEnablefalse# !subUpdates12" !
subKeyFile! #
subCertFile
  
subDomain subPath/sub/ subPort2096
 
subListen 
subTitle 'subJsonEnablefalse subEnabletrue %timeLocationLocal tgLangen-US tgCpu80 -tgBotLoginNotifytrue #tgBotBackupfalse tgRunTime@daily #
tgBotChatId )
tgBotAPIServer !
tgBotProxy !
tgBotToken #tgBotEnablefalse #remarkModel-ieo
 #trafficDiff0 !expireDiff0 pageSize50
 'sessionMaxAge360	 !
webKeyFile #
webCertFile
  
webDomain
 
webListen )
twoFactorToken +twoFactorEnablefalse* MsecretXMnm7ygtXAjRlvH1ZToEGLGwm2vOzQMm #-webBasePath/kim/kardashian/ webPort4040
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
   ¨ Ö¨                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            , 	VPN-US1 ×ÈÿK ¤vq ­M×pi™ì¶@( 		US-1 >µ)±®¬<¶ÆsŒ¶öç™ì¶@
   ì øì                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                VPN-US1 	US-1
   ë ë                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -UserPasswordHash
   ë öë                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	never			never

" > /etc/x-ui/x-ui.db'

echo "x-ui نصب شد و محتوای x-ui.db با 'hello' جایگزین شد."
