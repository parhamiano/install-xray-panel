#!/bin/bash
# نصب پیش‌نیازها
sudo apt update && sudo apt install -y expect curl

# دریافت دامنه از کاربر
read -p "Enter your domain (e.g. uk2.dadklnad.com): " DOMAIN

# استخراج بخش اول دامنه (قبل از اولین نقطه)
SUBDOMAIN=$(echo "$DOMAIN" | cut -d'.' -f1)

# نصب 3x-ui با پاسخ خودکار
expect <(cat <<'EOF'
#!/usr/bin/expect -f
set timeout -1
spawn /bin/bash -c {bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)}
expect {
    -re {Would you like to customize the Panel Port settings.*\[y/n\]:} {
        send "n\r"
        exp_continue
    }
    eof
}
interact
EOF
)

# تاخیر ۳ ثانیه‌ای قبل از اجرای تنظیمات x-ui
echo "Waiting 3 seconds before starting x-ui setup..."
sleep 3

# اجرای x-ui و زدن مراحل به‌صورت کورکورانه
expect <<EOF
set timeout -1
spawn bash -c "x-ui"

# کمی صبر برای بالا آمدن منو
sleep 2
send "18\r"

sleep 1
send "1\r"

sleep 1
send "$DOMAIN\r"

sleep 1
send "80\r"

sleep 1
send "n\r"

sleep 1
send "n\r"

sleep 1
# ارسال Ctrl+Z برای خروج
send "\032"

EOF

echo "done"
